{"ast":null,"code":"import _slicedToArray from\"/Users/robinscavo/Desktop/projects/KolorKrush/Kolor_Krusher-Express/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import React,{useState,useEffect}from\"react\";import{useStorageState}from'react-storage-hooks';import firebase from\"./firebase\";import UserContext from'./context/UserContext';import Controller from'./Controller';import Message from'./Components/Message/Message';function App(){var _useStorageState=useStorageState(localStorage,'state-user',{}),_useStorageState2=_slicedToArray(_useStorageState,2),user=_useStorageState2[0],setUser=_useStorageState2[1];var _useState=useState([]),_useState2=_slicedToArray(_useState,2),players=_useState2[0],setPlayers=_useState2[1];var _useState3=useState({key:null,name:'',email:'',score:0}),_useState4=_slicedToArray(_useState3,2),currentPlayer=_useState4[0],setCurrentPlayer=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),message=_useState6[0],setMessage=_useState6[1];useEffect(function(){var playersRef=firebase.database().ref('players');// .orderByChild('score');\nplayersRef.on('value',function(snapshot){var players=snapshot.val();var newStatePlayers=[];for(var player in players){newStatePlayers.push({key:player,name:players[player].name,email:players[player].email,password:players[player].password,score:players[player].score});}newStatePlayers.sort(function(a,b){return b.score-a.score;});setPlayers(newStatePlayers);});},[]);useEffect(function(){var targetPlayer={key:null,name:'',email:'',score:0};if(user.email){targetPlayer=players.find(function(player){return player.email===user.email;});}else{return;}firebase.auth().onAuthStateChanged(function(){if(targetPlayer){setCurrentPlayer({key:targetPlayer.key,name:targetPlayer.name,email:targetPlayer.email,score:targetPlayer.score});}});},[user,players]);var onLogin=function onLogin(email,password){firebase.auth().signInWithEmailAndPassword(email,password).then(function(response){setUser({email:response.user['email'],isAuthenticated:true});}).catch(function(){return setFlashMessage('invalidCredentialed');});};var onDemoLogin=function onDemoLogin(){return onLogin('player@gmail.com','121212');};var onLogout=function onLogout(){firebase.auth().signOut().then(function(){setCurrentPlayer({key:null,name:'',email:'',score:0});setUser({email:'',isAuthenticated:false});}).catch(function(){return setFlashMessage('logoutFailed');});};var onSignup=function onSignup(email,password,name,score){firebase.auth().createUserWithEmailAndPassword(email,password).then(function(credential){setUser({email:credential.user.email,isAuthenticated:true});addNewPlayer(email,password,name,score);}).catch(function(){return setFlashMessage('signupFailed');});};var onEdit=function onEdit(key,email,name,score){var playerRef=firebase.database().ref('players/'+key);playerRef.update({name:name,email:email,score:score});setFlashMessage('updated');};var updateScore=function updateScore(newScore){var playerRef=firebase.database().ref('players/'+currentPlayer.key);if(newScore>currentPlayer.score){playerRef.update({name:currentPlayer.name,email:currentPlayer.email,score:newScore});}};var setFlashMessage=function setFlashMessage(message){setMessage(message);setTimeout(function(){setMessage(null);},1600);};var addNewPlayer=function addNewPlayer(email,password,name,score){var playersRef=firebase.database().ref('players');// delete player.key\nplayersRef.push({name:name,email:email,password:password,score:score});setFlashMessage('saved');};var deletePlayer=function deletePlayer(player){if(window.confirm('Your account will be deleted. Proceed?')){var playerRef=firebase.database().ref('players/'+player);playerRef.remove();setFlashMessage('deleted');}onLogout();};return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(UserContext.Provider,{value:{user:user,players:players,currentPlayer:currentPlayer,onLogin:onLogin,onLogout:onLogout,onSignup:onSignup,onEdit:onEdit,onDemoLogin:onDemoLogin,addNewPlayer:addNewPlayer,deletePlayer:deletePlayer,updateScore:updateScore,setFlashMessage:setFlashMessage},children:[message&&/*#__PURE__*/_jsx(Message,{type:message}),/*#__PURE__*/_jsx(Controller,{})]})});}export default App;","map":{"version":3,"sources":["/Users/robinscavo/Desktop/projects/KolorKrush/Kolor_Krusher-Express/frontend/src/App.js"],"names":["React","useState","useEffect","useStorageState","firebase","UserContext","Controller","Message","App","localStorage","user","setUser","players","setPlayers","key","name","email","score","currentPlayer","setCurrentPlayer","message","setMessage","playersRef","database","ref","on","snapshot","val","newStatePlayers","player","push","password","sort","a","b","targetPlayer","find","auth","onAuthStateChanged","onLogin","signInWithEmailAndPassword","then","response","isAuthenticated","catch","setFlashMessage","onDemoLogin","onLogout","signOut","onSignup","createUserWithEmailAndPassword","credential","addNewPlayer","onEdit","playerRef","update","updateScore","newScore","setTimeout","deletePlayer","window","confirm","remove"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { useStorageState } from 'react-storage-hooks';\nimport firebase from \"./firebase\";\n\nimport UserContext from './context/UserContext'\nimport Controller from './Controller'\nimport Message from './Components/Message/Message'\n\nfunction App() {\n  const [user, setUser] = useStorageState(localStorage, 'state-user', {});\n  const [players, setPlayers] = useState([])\n  const [currentPlayer, setCurrentPlayer] = useState({ key: null, name: '', email: '', score: 0})\n  const [message, setMessage] = useState('')\n\n  useEffect(() => {\n    const playersRef =\n      firebase\n        .database()\n        .ref('players')\n        // .orderByChild('score');\n\n    playersRef.on('value', (snapshot) => {\n      const players = snapshot.val();\n      const newStatePlayers = [];\n\n      for (let player in players) {\n        newStatePlayers.push({\n          key: player,\n          name: players[player].name,\n          email: players[player].email,\n          password: players[player].password,\n          score: players[player].score,\n        })\n      }\n\n      newStatePlayers.sort(function(a, b) {\n        return b.score - a.score\n      })\n      setPlayers(newStatePlayers)\n    });\n  }, []);\n\n  useEffect(() => {\n    let targetPlayer = { key: null, name: '', email: '', score: 0}\n    if (user.email) {\n      targetPlayer = players.find((player) => (player.email === user.email))\n    } else {\n      return\n    }\n\n    firebase\n      .auth()\n      .onAuthStateChanged(() => {\n        if (targetPlayer) {\n          setCurrentPlayer({\n            key: targetPlayer.key,\n            name: targetPlayer.name,\n            email: targetPlayer.email,\n            score: targetPlayer.score\n          })\n        }\n      })\n  }, [user, players]);\n\n  const onLogin = (email, password) => {\n    firebase\n      .auth()\n      .signInWithEmailAndPassword(email, password)\n      .then((response) => {\n        setUser({\n          email: response.user['email'],\n          isAuthenticated: true,\n        })\n      })\n      .catch(() => setFlashMessage('invalidCredentialed'))\n  }\n\n  const onDemoLogin = () => onLogin('player@gmail.com', '121212')\n\n  const onLogout = () => {\n    firebase\n      .auth()\n      .signOut()\n      .then(() => {\n        setCurrentPlayer({\n          key: null,\n          name: '',\n          email: '',\n          score: 0\n        })\n\n        setUser({\n          email: '',\n          isAuthenticated: false\n        });\n      })\n      .catch(() => setFlashMessage('logoutFailed'))\n  }\n\n  const onSignup = (email, password, name, score) => {\n    firebase\n      .auth()\n      .createUserWithEmailAndPassword(email, password)\n      .then((credential) => {\n        setUser({\n          email: credential.user.email,\n          isAuthenticated: true,\n        })\n\n        addNewPlayer(email, password, name, score)\n      })\n      .catch(() => setFlashMessage('signupFailed'))\n  }\n\n  const onEdit = (key, email, name, score) => {\n    const playerRef = firebase.database().ref('players/' + key);\n    playerRef.update({\n      name: name,\n      email: email,\n      score: score,\n    })\n    setFlashMessage('updated')\n  }\n\n  const updateScore = (newScore) => {\n    const playerRef = firebase.database().ref('players/' + currentPlayer.key);\n    if(newScore > currentPlayer.score) {\n      playerRef.update({\n        name: currentPlayer.name,\n        email: currentPlayer.email,\n        score: newScore\n      })\n    }\n  }\n\n  const setFlashMessage = (message) => {\n    setMessage(message)\n    setTimeout(() => {\n      setMessage(null)\n    }, 1600)\n  }\n\n  const addNewPlayer = (email, password, name, score) => {\n    const playersRef = firebase.database().ref('players')\n    // delete player.key\n    playersRef.push({\n      name: name,\n      email: email,\n      password: password,\n      score: score\n    });\n    setFlashMessage('saved')\n  }\n\n  const deletePlayer = (player) => {\n    if (window.confirm('Your account will be deleted. Proceed?')) {\n      const playerRef = firebase.database().ref('players/' + player);\n      playerRef.remove();\n      setFlashMessage('deleted')\n    }\n    onLogout();\n  }\n\n  return (\n    <>\n      <UserContext.Provider value={{\n        user,\n        players,\n        currentPlayer,\n        onLogin,\n        onLogout,\n        onSignup,\n        onEdit,\n        onDemoLogin,\n        addNewPlayer,\n        deletePlayer,\n        updateScore,\n        setFlashMessage\n      }}>\n          {message && <Message type={message} />}\n          <Controller />\n      </UserContext.Provider>\n    </>\n)\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}